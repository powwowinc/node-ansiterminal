!function(){"use strict";function s(s,t,r,e){this.c=s,this.attr=0|t,this.gb=0|r,this.width=void 0===e?1:e}function t(s){return s.replace(/[\x00]+$/,"")}function r(t,r){this.uniqueId=0|b++,this.version=1,this.doubled=0,this.overflow=0,this.cells=[];for(var e=0;e<t;++e)this.cells.push(new s(r.c,r.attr,r.gb,r.width))}function e(s,t,r,e){var o=t>>>16&255,i=s>>>16&255^o,c=t>>>24,h=65535&t,n=[];return i&&(1&i&&n.push(1&o?1:22),2&i&&n.push(2&o?3:23),4&i&&n.push(4&o?4:24),8&i&&n.push(8&o?5:25),16&i&&n.push(16&o?7:27),32&i&&n.push(32&o?8:28)),(s>>>24^c||65535&s^h||r^e)&&(4&c?8&c?n.push(38,2,h>>>8,e>>>24,(65535&e)>>>8):n.push(38,5,1&o?h>>>8|8:h>>>8):67108864&s&&n.push(39),1&c?2&c?n.push(48,2,255&h,e>>>16&255,255&e):n.push(48,5,255&h):16777216&s&&n.push(49)),n.join(";")}function o(s){if("foreground"==s)return"#ffffff";if("background"==s)return"#000000";if(s<16)return d[s];if(s<232){var t=[0,95,135,175,215,255];s-=16;for(var r=0,e=0;e<3;++e)r+=t[s%6]<<8*e,s=parseInt(s/6);return r=r.toString(16),"#"+Array(6-r.length+1).join("0")+r}var o=8+10*(s-232);return"#"+(o+(o<<8)+(o<<16)).toString(16)}function i(s,t){var r="",e="";if(t.classes?(s.bold&&(e+="bold "),s.italic&&(e+="italic "),s.underline&&(e+="underline "),s.blink&&(e+="blink "),s.conceal&&(e+="conceal ")):(s.bold&&(r+="font-weight:bold;"),s.italic&&(r+="font-style:italic;"),s.underline&&(r+="font-decoration:underline;"),s.blink&&(r+="visibility:hidden;animation: "+t.blinkanimation+" 1s steps(1, start) infinite;"),s.conceal&&(r+="visibility:hidden;")),s.inverse){var o=s.foreground;s.foreground=s.background,s.background=o}if(s.foreground)if("RGB"==s.foreground.mode)r+="color:rgb(",r+=s.foreground.color.r,r+=",",r+=s.foreground.color.g,r+=",",r+=s.foreground.color.b,r+=");";else{var i=s.foreground.color;s.bold&&(i|=8),t.classes?e+="fg"+i+" ":r+="color:"+t.colors(i)+";"}else s.inverse&&(t.classes?e+="fg-1 ":r+="color:"+t.colors("background")+";");return s.background?"RGB"==s.background.mode?(r+="background-color:rgb(",r+=s.background.color.r,r+=",",r+=s.background.color.g,r+=",",r+=s.background.color.b,r+=");"):t.classes?e+="bg"+s.background.color+" ":r+="background-color:"+t.colors(s.background.color)+";":s.inverse&&(t.classes?e+="bg-1 ":r+="background-color:"+t.colors("foreground")+";"),e&&(e=' class="'+e.trim()+'"'),r&&(r=' style="'+r.trim()+'"'),e+r}function c(s){return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function h(s,t,r){if(r.classes){return'<span class="'+["","dbl-width","","dbl-height-top","dbl-height-bottom"][t]+'">'+s+"</span>"}var e="";switch(t){case 1:e='<span style="',e+="transform: scale(2,1);",e+="display: inline-block;",e+='margin-left:25%">',e+=s,e+="</span>";break;case 3:e='<span style="',e+="display: inline-block;",e+="vertical-align:bottom;",e+="margin: -0.667em 25% 0.667em;",e+="overflow: hidden;",e+='transform: scale(2, 2);">',e+='<span style="display: inline-block;transform: translateY(0.5em);">',e+=s,e+="</span></span>";break;case 4:e='<span style="',e+="display: inline-block;",e+="vertical-align:top;",e+="margin-left: 25%;",e+="overflow: hidden;",e+='transform: scale(2, 2);">',e+='<span style="display: inline-block;transform: translateY(-0.46em);">',e+=s,e+="</span></span>"}return e}function n(s,t,r){this.rows=t,this.cols=s,this.scrollLength=r==1/0?2147483647:0|r,this.buffer=[],this.scrollbuffer=[],this.reset()}function l(s,t,r){this.rows=t,this.cols=s,this.scrollLength=r===1/0?2147483647:0|r,this.send=function(s){},this.beep=function(s,t){},this.changedMouseHandling=function(s,t){},this.reset()}function a(){return new function(){this.hook=function(s,t,r,e){console.log("inst_H unhandled:",t,r,e)},this.feed=function(s){console.log("inst_P unhandled:",s)},this.unhook=function(){}}}function u(){return new function(){this.term=null,this.data="",this.limit=5,this.hook=function(s){this.term=s,this.data=""},this.feed=function(s){this.data.length<this.limit&&(this.data+=s)},this.unhook=function(){switch(this.data){case'"q':return this.term.send("");case'"p':return this.term.send('P1$r64;1"p\\');case"r":var s=this.term.scrolling_top+1,t=this.term.scrolling_bottom+1;return this.term.send("P1$r"+s+";"+t+"r\\");case"m":var r="0";return this.term.textattributes&&(r+=";"+e(0,this.term.textattributes,0,this.term.colors)),this.term.send("P1$r"+r+"m\\");default:this.term.send("P0$r\\")}}}}var f=function(){function s(s){var t,r=0,o=e.length-1;if(s<e[0][0]||s>e[o][1])return!1;for(;o>=r;)if(t=Math.floor((r+o)/2),s>e[t][1])r=t+1;else{if(!(s<e[t][0]))return!0;o=t-1}return!1}function t(t,r){return 0===t?r.nul:t<32||t>=127&&t<160?r.control:s(t)?0:1+(t>=4352&&(t<=4447||9001==t||9002==t||t>=11904&&t<=42191&&12351!=t||t>=44032&&t<=55203||t>=63744&&t<=64255||t>=65040&&t<=65049||t>=65072&&t<=65135||t>=65280&&t<=65376||t>=65504&&t<=65510||t>=131072&&t<=196605||t>=196608&&t<=262141))}function r(s,r){if(r=o,"string"!=typeof s)return t(s,r);for(var e=0,i=0;i<s.length;i++){var c=t(s.charCodeAt(i),r);if(c<0)return-1;e+=c}return e}var e=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531],[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],o={nul:0,control:0};return r}();s.prototype.clone=function(){return new s(this.c,this.attr,this.gb,this.width)},s.prototype.equals=function(t){return t instanceof s&&this.c==t.c&&this.attr==t.attr&&this.gb==t.gb&&this.width==t.width},s.prototype.serialize=function(){return[this.c,this.attr,this.gb,this.width]},s.deserialize=function(t){return new s(t[0],t[1],t[2],t[3])},s.prototype.getAttributes=function(){var s=this.attr>>>24,t=65535&this.attr,r=this.gb>>>16,e=65535&this.gb,o=this.attr>>>16&255;return{bold:!!(1&o),italic:!!(2&o),underline:!!(4&o),blink:!!(8&o),inverse:!!(16&o),conceal:!!(32&o),foreground:{set:!!(4&s),RGB:!!(8&s),color:[t>>>8,r>>>8,e>>>8]},background:{set:!!(1&s),RGB:!!(2&s),color:[255&t,255&r,255&e]}}},s.prototype.getJSONAttributes=function(){var s=this.attr>>>24,t=65535&this.attr,r=this.gb>>>16,e=65535&this.gb,o=this.attr>>>16&255,i={bold:!!(1&o),italic:!!(2&o),underline:!!(4&o),blink:!!(8&o),inverse:!!(16&o),conceal:!!(32&o),foreground:!1,background:!1};return 4&s&&(i.foreground={},8&s?(i.foreground.mode="RGB",i.foreground.color={r:t>>>8,g:r>>>8,b:e>>>8}):(i.foreground.mode="256",i.foreground.color=t>>>8)),1&s&&(i.background={},2&s?(i.background.mode="RGB",i.background.color={r:255&t,g:255&r,b:255&e}):(i.background.mode="256",i.background.color=255&t)),i},s.prototype.setAttributes=function(s){if(0===s)return this.attr=0,void(this.gb=0);var t=this.attr;if(["bold","italic","underline","blink","inverse","conceal"].map(function(r,e){void 0!==s[r]&&(t=s[r]?t|2<<15+e:t&~(2<<15+e))}),s.foreground){var r=s.foreground;void 0!==r.set&&(t=r.set?t|2<<25:t&~(2<<25)),void 0!==r.RGB&&(t=r.RGB?t|2<<26:t&~(2<<26)),void 0!==r.color&&(t=-65281&t|r.color[0]<<8,this.gb=16777215&this.gb|r.color[1]<<24,this.gb=-65281&this.gb|r.color[2]<<8)}if(s.background){var e=s.background;void 0!==e.set&&(t=e.set?t|2<<23:t&~(2<<23)),void 0!==e.RGB&&(t=e.RGB?t|2<<24:t&~(2<<24)),void 0!==e.color&&(t=-256&t|e.color[0],this.gb=-16711681&this.gb|e.color[1]<<16,this.gb=-256&this.gb|e.color[2])}this.attr=t};var b=0;r.prototype.serialize=function(){for(var s={content:[],attributes:{doubled:this.doubled}},t=0;t<this.cells.length;++t)s.content.push(this.cells[t].serialize());return s},r.deserialize=function(t){for(var e=new r(0,null),o=0;o<t.content.length;++o)e.cells.push(s.deserialize(t.content[o]));return e.doubled=t.attributes.doubled,e},r.prototype.toString=function(s){var r={rtrim:!0,empty_cell:" "};s&&(s.hasOwnProperty("rtrim")&&(r.rtrim=s.rtrim),s.hasOwnProperty("empty_cell")&&(r.empty_cell=s.empty_cell));for(var e="",o=0;o<this.cells.length;++o)e+=this.cells[o].c||"\0";return r.rtrim&&(e=t(e)),e.replace(/\x00/g,r.empty_cell)},r.prototype.toMergedArray=function(s){var r={rtrim:!1,empty_cell:"Â "};s&&(s.hasOwnProperty("rtrim")&&(r.rtrim=s.rtrim),s.hasOwnProperty("empty_cell")&&(r.empty_cell=s.empty_cell));var e=[];if(!this.cells.length)return e;var o=null,i=this.cells.length;this.doubled&&(i=parseInt(i/2));var c=this.cells[0].clone();c.c=c.c||"\0";for(var h=1;h<i;++h)o=this.cells[h],c.attr!==o.attr?(e.push(c),c=o.clone(),c.c=c.c||"\0"):o.width&&(c.c+=o.c||"\0",c.width+=o.width);if(e.push(c),r.rtrim)for(;e.length;){var n=e.pop(),l=t(n.c);if(l.length){n.width-=n.c.length-l.length,n.c=l,e.push(n);break}}for(h=0;h<e.length;++h)e[h].c=e[h].c.replace(/\x00/g,r.empty_cell);return e},r.prototype.toJSON=function(s){for(var t={content:[],attributes:{doubled:this.doubled}},r=this.toMergedArray(s),e=null,o=0;o<r.length;++o)e=r[o],t.content.push({string:e.c,width:e.width,attributes:e.getJSONAttributes()});return t},r.prototype.toEscapeString=function(s){var t="[0m";switch(this.doubled){case 0:t+="#5";break;case 1:t+="#6";break;case 3:t+="#3";break;case 4:t+="#4"}for(var r=this.toMergedArray(s),o=null,i=0,c=0,h=0;h<r.length;++h)o=r[h],t+="["+(o.attr?e(i,o.attr,c,o.gb):"0")+"m",t+=o.c,i=o.attr,c=o.gb;return i&&(t+="[0m"),t};var d=["#000000","#cd0000","#00cd00","#cdcd00","#0000ee","#cd00cd","#00cdcd","#e5e5e5","#7f7f7f","#ff0000","#00ff00","#ffff00","#5c5cff","#ff00ff","#00ffff","#ffffff"];r.prototype.toHTML=function(s){var t={rtrim:!0,empty_cell:"Â ",blinkanimation:"blink",classes:!0,colors:o,escape_html:!0};if(s)for(var r=["rtrim","empty_cell","blinkanimation","colors","classes"],e=0;e<r.length;++e)s.hasOwnProperty(r[e])&&(t[r[e]]=s[r[e]]);for(var n=this.toMergedArray(t),l="",a=null,u=0;u<n.length;++u)a=n[u],a.attr&&(l+="<span"+i(a.getJSONAttributes(),t)+">"),l+=t.escape_html?c(a.c):a.c,a.attr&&(l+="</span>");return this.doubled?h(l,this.doubled,t):l},n.prototype.reset=function(){this.buffer=[],this.scrollbuffer=[];for(var t,e=0;e<this.rows;++e)t=new r(this.cols,new s("")),this.buffer.push(t)},n.prototype.serialize=function(){var s,t=[],r=[];for(s=0;s<this.buffer.length;++s)t.push(this.buffer[s].serialize());for(s=0;s<this.scrollbuffer.length;++s)r.push(this.scrollbuffer[s].serialize());return{cols:this.cols,rows:this.rows,scrollLength:this.scrollLength,buffer:t,scrollbuffer:r}},n.deserialize=function(s){var t,e=new n(0,0,0);for(e.rows=s.rows,e.cols=s.cols,e.scrollLength=s.scrollLength,t=0;t<e.rows;++t)e.buffer.push(r.deserialize(s.buffer[t]));for(t=0;t<e.scrollLength;++t)e.scrollbuffer.push(r.deserialize(s.scrollbuffer[t]));return e},n.prototype.appendToScrollBuffer=function(s){for(this.scrollbuffer.push(s);this.scrollbuffer.length>this.scrollLength;)this.scrollbuffer.shift()},n.prototype.fetchFromScrollBuffer=function(){return this.scrollbuffer.pop()},n.prototype.resize=function(t,e,o){if(e<this.rows)for(;this.buffer.length>e;)this.buffer.length>o.row+1?this.buffer.pop():(this.appendToScrollBuffer(this.buffer.shift()),o.row-=1);if(e>this.rows)for(;this.buffer.length<e;){var i=this.fetchFromScrollBuffer();i?(this.buffer.unshift(i),o.row+=1):(i=new r(this.cols,new s("")),this.buffer.push(i))}o.row>=e&&(o.row=e-1);var c;if(t<this.cols){for(c=0;c<this.buffer.length;++c){var h=this.cols-t;do{this.buffer[c].cells.pop()}while(--h);this.buffer[c].version++}for(c=0;c<this.scrollbuffer.length;++c){h=this.cols-t;do{this.scrollbuffer[c].cells.pop()}while(--h);this.scrollbuffer[c].version++}}if(t>this.cols){for(c=0;c<this.buffer.length;++c){var n=t-this.cols;do{this.buffer[c].cells.push(new s(""))}while(--n);this.buffer[c].version++}for(c=0;c<this.scrollbuffer.length;++c){n=t-this.cols;do{this.scrollbuffer[c].cells.push(new s(""))}while(--n);this.scrollbuffer[c].version++}}o.col>=t&&(o.col=t-1),this.rows=e,this.cols=t},n.prototype.resize_reflow=function(t,e,o){var i=0,c=0,h=null,n=[[]],l=n[n.length-1];for(i=0;i<this.scrollbuffer.length;++i){for(c=0;c<this.cols;++c)h=this.scrollbuffer[i].cells[c],l.push(h);this.scrollbuffer[i].overflow||(n.push([]),l=n[n.length-1])}for(i=0;i<this.rows;++i){for(c=0;c<this.cols;++c)h=this.buffer[i].cells[c],l.push(h);this.buffer[i].overflow||(n.push([]),l=n[n.length-1])}for(var a=0;a<n.length;++a){for(var u=n[a].pop();u&&""==u.c&&1==u.width;)u=n[a].pop();u&&""!=u.c&&n[a].push(u)}for(var f=n.pop();f&&!f.length;)f=n.pop();f&&n.push(f);var b=[];for(i=0;i<n.length;++i){var d=new r(t,new s("")),p=0;for(c=0;c<n[i].length;++c)parseInt(c/t)>p&&(p++,d.overflow=1,b.push(d),d=new r(t,new s(""))),d.cells[c%t]=n[i][c];b.push(d),d=new r(t,new s(""))}for(this.scrollbuffer=[];b.length<e;)b.push(new r(t,new s("")));for(;b.length>e;)this.appendToScrollBuffer(b.shift());this.buffer=b,o.row>=e&&(o.row=e-1),o.col>=t&&(o.col=t-1),this.rows=e,this.cols=t};var p={"`":"â",a:"â",b:"â",c:"â",d:"â",e:"â",f:"Â°",g:"Â±",h:"â¤",i:"â",j:"â",k:"â",l:"â",m:"â",n:"â¼",o:"âº",p:"â»",q:"â",r:"â¼",s:"â½",t:"â",u:"â¤",v:"â´",w:"â¬",x:"â",y:"â¤",z:"â¥","{":"Ï","|":"â ","}":"Â£","~":"Â°"},w={"â":"â","â":"â","â":"â","â":"â","â":"â","â":"â","â":"â","â":"â","â":"â","â":"â","â":"â£","â¤":"â«","â¬":"â³","â´":"â»","â¼":"â","â":"â","â":"â"},g={CSI:"[",SS3:"O",DCS:"P",ST:"\\",OSC:"]",PM:"^",APC:"_"};l.prototype.reset=function(){this.normal_screen=new n(this.cols,this.rows,this.scrollLength),this.alternate_screen=new n(this.cols,this.rows,0),this.screen=this.normal_screen,this.normal_cursor={col:0,row:0},this.alternate_cursor={col:0,row:0},this.cursor=this.normal_cursor,this.textattributes=0,this.colors=0,this.charattributes=0,this.reverse_video=!1,this.cursor_key_mode=!1,this.show_cursor=!0,this.title="",this.cursor_save=null,this.insert_mode=!1,this.blinking_cursor=!1,this.scrolling_top=0,this.scrolling_bottom=this.rows,this.autowrap=!0,this.newline_mode=!1,this.tab_width=8,this.last_char="",this.mouse_mode=0,this.mouse_protocol=0,this.mouseDown={1:!1,2:!1,3:!1,4:!1},this._rem_c="",this.wrap=!1,this.row_wrap=!1,this.dcs_handler=null,this.dcs_handlers={},this.registerDCSHandler(u,"$","q"),this.G0=null,this.G1=null,this.charset=this.G0,this.active_charset=0,this.reflow=!1},l.prototype.toString=function(s){for(var t="",r=0;r<this.screen.buffer.length;++r)t+=this.screen.buffer[r].toString(s),t+="\n";return t},l.prototype.resize=function(s,t){var r=this.reflow?"resize_reflow":"resize";if(s<2||t<2)return!1;this.normal_screen[r](s,t,this.normal_cursor),this.alternate_screen[r](s,t,this.alternate_cursor),this.rows=t,this.cols=s,this.scrolling_top=0,this.scrolling_bottom=this.rows,this.cursor_save&&this.DECSC()},l.prototype.registerDCSHandler=function(s,t,r){this.dcs_handlers[r+t]=s},l.prototype.unregisterDCSHandler=function(s){for(var t in this.dcs_handlers)if(this.dcs_handlers.hasOwnProperty(t)&&this.dcs_handlers[t]===s){delete this.dcs_handlers[t];break}},l.prototype.inst_p=function(t){this.log("inst_p",t);var r="",e=0,o=0,i=1;this._rem_c&&(t=this._rem_c+t,this._rem_c="");for(var c=0;c<t.length;++c){if(r=t.charAt(c),55296<=(e=t.charCodeAt(c))&&e<=56319){if((o=t.charCodeAt(c+1))!==o)return void(this._rem_c=r);e=1024*(e-55296)+(o-56320)+65536,r+=t.charAt(c+1)}if(!(56320<=e&&e<=57343)){if(2==(i=f(e))&&i+this.cursor.col>this.cols){if(!this.autowrap)continue;this.wrap=!0}if(this.wrap&&i&&(this.cursor.col=0,this.screen.buffer[this.cursor.row].overflow=1,this.cursor.row++,this.wrap=!1),this.cursor.row>=this.scrolling_bottom&&(this.SU(),this.cursor.row--),this.screen.buffer[this.cursor.row].version++,!i&&this.cursor.col)this.wrap?this.screen.buffer[this.cursor.row].cells[this.cursor.col].c+=r:0==this.screen.buffer[this.cursor.row].cells[this.cursor.col-1].width?this.cursor.col-2>=0&&2==this.screen.buffer[this.cursor.row].cells[this.cursor.col-2].width&&(this.screen.buffer[this.cursor.row].cells[this.cursor.col-2].c+=r):this.screen.buffer[this.cursor.row].cells[this.cursor.col-1].c+=r;else{if(r=this.charset?this.charset[r]||r:r,this.last_char=r,this.insert_mode&&(this.screen.buffer[this.cursor.row].cells.pop(),this.screen.buffer[this.cursor.row].cells.splice(this.cursor.col,0,new s("",this.textattributes,this.colors))),this.screen.buffer[this.cursor.row].cells[this.cursor.col].c=r,this.screen.buffer[this.cursor.row].cells[this.cursor.col].attr=this.charattributes,this.screen.buffer[this.cursor.row].cells[this.cursor.col].gb=this.colors,this.screen.buffer[this.cursor.row].cells[this.cursor.col].width=i,r>="â"&&r<="â"&&this.textattributes&&65536&this.textattributes){this.screen.buffer[this.cursor.row].cells[this.cursor.col].c=w[r]||r;var h=-65537&this.charattributes;67108864&h&&!(134217728&h)&&(h>>>8&255)<8&&(h|=2048),this.screen.buffer[this.cursor.row].cells[this.cursor.col].attr=h}this.cursor.col+=1}2==i&&(this.insert_mode&&(this.screen.buffer[this.cursor.row].cells.pop(),this.screen.buffer[this.cursor.row].cells.splice(this.cursor.col,0,new s("",this.textattributes,this.colors)),2==this.screen.buffer[this.cursor.row].cells[this.cols-1].width&&(this.screen.buffer[this.cursor.row].cells.pop(),this.screen.buffer[this.cursor.row].cells.push(new s("",this.textattributes,this.colors)))),this.screen.buffer[this.cursor.row].cells[this.cursor.col].width=0,this.screen.buffer[this.cursor.row].cells[this.cursor.col].c="",this.screen.buffer[this.cursor.row].cells[this.cursor.col].attr=this.charattributes,this.screen.buffer[this.cursor.row].cells[this.cursor.col].gb=this.colors,this.cursor.col+=1,this.cursor.col>=this.cols&&(this.cursor.col=this.cols-2,this.autowrap&&(this.wrap=!0))),this.cursor.col>=this.cols&&(this.cursor.col=this.cols-1,this.autowrap&&(this.wrap=!0))}}},l.prototype.inst_o=function(s){this.log("inst_o",s),this.last_char="",this._rem_c="",this.wrap=!1,"0"==s.charAt(0)?this.title=s.slice(2):this.log("inst_o unhandled:",s)},l.prototype.inst_x=function(s){switch(this.debug&&this.log("inst_x",s.charCodeAt(0),s),this.last_char="",this._rem_c="",this.wrap=!1,s){case"\n":this.screen.buffer[this.cursor.row].overflow=0,this.cursor.row++,this.cursor.row>=this.scrolling_bottom&&(this.SU(),this.cursor.row--),this.newline_mode&&(this.cursor.col=0),this.cursor.col>=this.cols&&this.cursor.col--;break;case"\r":this.cursor.col=0;break;case"\t":this.CHT([0]);break;case"\0":break;case"":this.beep();break;case"\b":this.cursor.col>=this.cols&&(this.cursor.col=this.cols-1),this.cursor.col-=1,this.cursor.col<0&&(this.cursor.col=0);break;case"\v":case"\f":this.inst_x("\n");break;case"":this.charset=this.G1,this.active_charset=1;break;case"":this.charset=this.G0,this.active_charset=0;break;case"":this.log("unhandled DC1 (XON)");break;case"":break;case"":this.log("unhandled DC3 (XOFF)");break;case"":break;default:this.log("inst_x unhandled:",s.charCodeAt(0))}},l.prototype.inst_c=function(s,t,r){switch(this.log("inst_c",s,t,r),"b"!=r&&(this.last_char=""),"S"!==r&&"T"!==r&&(this._rem_c="",this.wrap=!1),s){case"":switch(r){case"@":return this.ICH(t);case"E":return this.CNL(t);case"F":return this.CPL(t);case"G":return this.CHA(t);case"D":return this.CUB(t);case"B":return this.CUD(t);case"C":return this.CUF(t);case"A":return this.CUU(t);case"I":return this.CHT(t);case"Z":return this.CBT(t);case"f":case"H":return this.CUP(t);case"P":return this.DCH(t);case"J":return this.ED(t);case"K":return this.EL(t);case"L":return this.IL(t);case"M":return this.DL(t);case"S":return this.SU(t);case"T":return this.SD(t);case"X":return this.ECH(t);case"a":return this.HPR(t);case"b":return this.REP(t);case"e":return this.VPR(t);case"d":return this.VPA(t);case"c":return this.send(g.CSI+"?62c");case"h":return this.high(s,t);case"l":return this.low(s,t);case"m":return this.SGR(t);case"n":return this.DSR(s,t);case"r":return this.DECSTBM(t);case"s":return this.DECSC();case"u":return this.DECRC();case"`":return this.HPA(t);default:this.log("inst_c unhandled:",s,t,r)}break;case"?":switch(r){case"J":return this.ED(t);case"K":return this.EL(t);case"h":return this.high(s,t);case"l":return this.low(s,t);case"n":return this.DSR(s,t);default:this.log("inst_c unhandled:",s,t,r)}break;case">":switch(r){case"c":return this.send(g.CSI+">41;1;0c");default:this.log("inst_c unhandled:",s,t,r)}break;case"!":switch(r){case"p":return this.DECSTR();default:this.log("inst_c unhandled:",s,t,r)}break;default:this.log("inst_c unhandled:",s,t,r)}},l.prototype.inst_e=function(s,t){if(this.log("inst_e",s,t),this.last_char="",this._rem_c="",this.wrap=!1,s)if(" "==s)this.log("inst_e unhandled:",s,t);else if("#"==s)switch(t){case"3":return this.DECDHL(3);case"4":return this.DECDHL(4);case"5":return this.DECSWL();case"6":return this.DECDWL();case"8":return this.DECALN();default:this.log("inst_e unhandled:",s,t)}else if("%"==s)this.charset=null;else if("("==s){switch(t){case"0":this.G0=p;break;default:this.G0=null}0==this.active_charset&&(this.charset=this.G0)}else if(")"==s){switch(t){case"0":this.G1=p;break;default:this.G1=null}1==this.active_charset&&(this.charset=this.G1)}else this.log("inst_e unhandled:",s,t);else switch(t){case"7":return this.DECSC();case"8":return this.DECRC();case"D":return this.IND();case"E":return this.NEL();case"M":return this.RI();case"c":return this.reset();default:this.log("inst_e unhandled:",s,t)}},l.prototype.inst_H=function(s,t,r){this.last_char="",this._rem_c="",this.wrap=!1;var e=this.dcs_handlers[r+s];this.dcs_handler=e?e():a(),this.dcs_handler.hook(this,s,t,r)},l.prototype.inst_P=function(s){this.last_char="",this._rem_c="",this.wrap=!1,this.dcs_handler.feed(s)},l.prototype.inst_U=function(){this.last_char="",this._rem_c="",this.wrap=!1,this.dcs_handler.unhook(),this.dcs_handler=null},l.prototype.DECDHL=function(s){this.screen.buffer[this.cursor.row].doubled=s},l.prototype.DECDWL=function(){this.screen.buffer[this.cursor.row].doubled=1},l.prototype.DECSWL=function(){this.screen.buffer[this.cursor.row].doubled=0},l.prototype.DECALN=function(){this.scrolling_top=0,this.scrolling_bottom=this.rows;for(var t=0;t<this.screen.buffer.length;++t)for(var r=0;r<this.screen.buffer[t].cells.length;++r)this.screen.buffer[t].cells[r]=new s("E");this.CUP([0,0])},l.prototype.SD=function(t){var e=t?t[0]||1:1;do{var o=new r(this.cols,new s("",this.textattributes,this.colors));this.screen.buffer.splice(this.scrolling_top,0,o),this.screen.buffer.splice(this.scrolling_bottom,1)}while(--e)},l.prototype.SU=function(t){var e=t?t[0]||1:1;do{var o=new r(this.cols,new s("",this.textattributes,this.colors));this.screen.buffer.splice(this.scrolling_bottom,0,o);var i=this.screen.buffer.splice(this.scrolling_top,1)[0];this.scrolling_top||this.screen.appendToScrollBuffer(i)}while(--e)},l.prototype.REP=function(s){var t=s?s[0]||1:1;if(this.last_char){var r=this.wrap;this.cursor.col==this.cols-1&&(this.wrap=!0),this.inst_p(Array(t+1).join(this.last_char)),this.wrap=r,this.last_char=""}},l.prototype.NEL=function(){this.IND(),this.cursor.col=0},l.prototype.IND=function(){++this.cursor.row>=this.scrolling_bottom&&(this.SU(),this.cursor.row--)},l.prototype.VPR=function(s){this.cursor.row+=s[0]?s[0]:1,this.cursor.row>=this.rows&&(this.cursor.row=this.rows-1)},l.prototype.HPR=function(s){this.cursor.col+=s[0]?s[0]:1,this.cursor.col>=this.cols&&(this.cursor.col=this.cols-1)},l.prototype.HPA=function(s){this.cursor.col=(s[0]?s[0]:1)-1,this.cursor.col>=this.cols&&(this.cursor.col=this.cols-1)},l.prototype.CBT=function(s){this.cursor.col=(Math.floor((this.cursor.col-1)/this.tab_width)+1-(s[0]?s[0]:1))*this.tab_width,this.cursor.col<0&&(this.cursor.col=0)},l.prototype.CHT=function(s){this.cursor.col=(Math.floor(this.cursor.col/this.tab_width)+(s[0]?s[0]:1))*this.tab_width,this.cursor.col>=this.cols&&(this.cursor.col=this.cols-1)},l.prototype.CPL=function(s){this.cursor.row-=s[0]?s[0]:1,this.cursor.row<0&&(this.cursor.row=0),this.cursor.col=0},l.prototype.CNL=function(s){this.cursor.row+=s[0]?s[0]:1,this.cursor.row>=this.rows&&(this.cursor.row=this.rows-1),this.cursor.col=0},l.prototype.DL=function(t){var e=t[0]||1;do{this.screen.buffer.splice(this.cursor.row,1);var o=new r(this.cols,new s("",this.textattributes,this.colors));this.screen.buffer.splice(this.scrolling_bottom-1,0,o)}while(--e);this.cursor.col=0},l.prototype.ICH=function(t){var r=t[0]||1;do{this.screen.buffer[this.cursor.row].cells.splice(this.cursor.col,0,new s("",this.textattributes,this.colors)),this.screen.buffer[this.cursor.row].cells.pop()}while(--r)},l.prototype.VPA=function(s){this.cursor.row=(s[0]?s[0]:1)-1,this.cursor.row>=this.rows&&(this.cursor.row=this.rows-1)},l.prototype.ECH=function(t){var r=(t[0]?t[0]:1)+this.cursor.col;r=this.cols<r?this.cols:r;for(var e=this.cursor.col;e<r;++e)this.screen.buffer[this.cursor.row].cells[e]=new s("",this.textattributes,this.colors);this.screen.buffer[this.cursor.row].version++},l.prototype.IL=function(t){var e=t[0]?t[0]:1;do{var o=new r(this.cols,new s("",this.textattributes,this.colors));this.screen.buffer.splice(this.cursor.row,0,o),this.screen.buffer.splice(this.scrolling_bottom,1)}while(--e);this.cursor.col=0},l.prototype.DECSTBM=function(s){var t=s[0]-1||0,r=s[1]||this.rows;t=t<0?0:t>=this.rows?this.rows-1:t,r=r>this.rows?this.rows:r,r>t&&(this.scrolling_top=t,this.scrolling_bottom=r),this.cursor.row=0,this.cursor.col=0},l.prototype.DECSTR=function(){this.show_cursor=!0,this.insert_mode=!1,this.CUP(),this.cursor_key_mode=!1,this.DECSTBM([]),this.charset=null,this.SGR([0]),this.DECSC()},l.prototype.RI=function(){if(this.cursor.row-=1,this.cursor.row<this.scrolling_top){this.cursor.row=this.scrolling_top;var t=new r(this.cols,new s("",this.textattributes,this.colors));this.screen.buffer.splice(this.scrolling_top,0,t),this.screen.buffer.splice(this.scrolling_bottom,1)}},l.prototype.DECSC=function(){var s={};s.cursor={row:this.cursor.row,col:this.cursor.col},s.textattributes=this.textattributes,s.charattributes=this.charattributes,this.cursor_save=s},l.prototype.DECRC=function(){this.cursor_save?(this.cursor.col=this.cursor_save.cursor.col,this.cursor.row=this.cursor_save.cursor.row,this.textattributes=this.cursor_save.textattributes,this.charattributes=this.cursor_save.charattributes):(this.CUP(),this.ED([2]),this.textattributes=0,this.charattributes=0)},l.prototype.high=function(s,t){for(var r=0;r<t.length;++r)switch(t[r]){case 1:this.cursor_key_mode=!0;break;case 4:s?this.log("unhandled high",s,t[r]):this.insert_mode=!0;break;case 7:"?"==s?this.autowrap=!0:this.log("unhandled high",s,t[r]);break;case 12:"?"==s?this.blinking_cursor=!0:this.log("unhandled high",s,t[r]);break;case 20:s?this.log("unhandled high",s,t[r]):this.newline_mode=!0;break;case 25:this.show_cursor=!0;break;case 43:case 44:case 45:case 46:case 47:break;case 9:case 1e3:case 1001:case 1002:case 1003:this.mouse_mode=t[r],this.changedMouseHandling(this.mouse_mode,this.mouse_protocol);break;case 1005:case 1006:case 1015:this.mouse_protocol=t[r],this.changedMouseHandling(this.mouse_mode,this.mouse_protocol);break;case 1049:this.screen=this.alternate_screen,this.cursor=this.alternate_cursor;break;default:this.log("unhandled high",s,t[r])}},l.prototype.low=function(s,t){for(var r=0;r<t.length;++r)switch(t[r]){case 1:this.cursor_key_mode=!1;break;case 4:s?this.log("unhandled low",s,t[r]):this.insert_mode=!1;break;case 7:"?"==s?this.autowrap=!1:this.log("unhandled high",s,t[r]);break;case 12:"?"==s?this.blinking_cursor=!1:this.log("unhandled high",s,t[r]);break;case 20:s?this.log("unhandled high",s,t[r]):this.newline_mode=!1;break;case 25:this.show_cursor=!1;break;case 43:case 44:case 45:case 46:case 47:break;case 9:case 1e3:case 1001:case 1002:case 1003:this.mouse_mode=0,this.changedMouseHandling(this.mouse_mode,this.mouse_protocol);break;case 1005:case 1006:case 1015:this.mouse_protocol=0,this.changedMouseHandling(this.mouse_mode,this.mouse_protocol);break;case 1049:this.screen=this.normal_screen,this.cursor=this.normal_cursor;break;default:this.log("unhandled low",s,t[r])}},l.prototype.DSR=function(s,t){switch(t[0]){case 5:this.send(g.CSI+"0n");break;case 6:this.send(g.CSI+s+(this.cursor.row+1)+";"+(this.cursor.col+1)+"R");break;case 75:this.send(g.CSI+"?70n");break;default:this.log("unhandled DSR",s,t)}},l.prototype.CHA=function(s){this.cursor.col=(s?s[0]||1:1)-1,this.cursor.col>=this.cols&&(this.cursor.col=this.cols-1)},l.prototype.CUB=function(s){this.cursor.col-=s?s[0]||1:1,this.cursor.col<0&&(this.cursor.col=0)},l.prototype.CUD=function(s){this.cursor.row+=s?s[0]||1:1,this.cursor.row>=this.rows&&(this.cursor.row=this.rows-1)},l.prototype.CUF=function(s){this.cursor.col+=s?s[0]||1:1,this.cursor.col>=this.cols&&(this.cursor.col=this.cols-1)},l.prototype.CUU=function(s){this.cursor.row-=s?s[0]||1:1,this.cursor.row<0&&(this.cursor.row=0)},l.prototype.CUP=function(s){this.cursor.row=(s?s[0]||1:1)-1,this.cursor.row>=this.rows&&(this.cursor.row=this.rows-1),this.cursor.col=(s?s[1]||1:1)-1,this.cursor.col>=this.cols&&(this.cursor.col=this.cols-1)},l.prototype.DCH=function(t){for(var r=this.screen.buffer[this.cursor.row].cells.splice(this.cursor.col,t?t[0]||1:1),e=0;e<r.length;++e)this.screen.buffer[this.cursor.row].cells.push(new s("",this.textattributes,this.colors));this.screen.buffer[this.cursor.row].version++},l.prototype.ED=function(t){var e,o;switch(t?t[0]:0){case 0:for(this.EL([0]),e=this.cursor.row+1;e<this.rows;++e)o=new r(this.cols,new s("",this.textattributes,this.colors)),this.screen.buffer[e]=o;break;case 1:for(e=0;e<this.cursor.row;++e)o=new r(this.cols,new s("",this.textattributes,this.colors)),this.screen.buffer[e]=o;this.EL([1]);break;case 2:for(e=0;e<this.rows;++e)o=new r(this.cols,new s("",this.textattributes,this.colors)),this.screen.buffer[e]=o}},l.prototype.EL=function(t){var r;switch(t?t[0]:0){case 0:for(r=this.cursor.col;r<this.cols;++r)this.screen.buffer[this.cursor.row].cells[r]=new s("",this.textattributes,this.colors);this.screen.buffer[this.cursor.row].version++;break;case 1:for(r=0;r<=this.cursor.col;++r)this.screen.buffer[this.cursor.row].cells[r]=new s("",this.textattributes,this.colors);this.screen.buffer[this.cursor.row].version++;break;case 2:for(r=0;r<this.cols;++r)this.screen.buffer[this.cursor.row].cells[r]=new s("",this.textattributes,this.colors);this.screen.buffer[this.cursor.row].version++}},l.prototype.SGR=function(s){var t=this.textattributes,r=this.colors,e=0,o=!1,i=0;this.reverse_video&&(t|=1048576);for(var c=0;c<s.length;++c)if(e){if(!i){switch(s[c]){case 2:o=!0,i=3,t|=38==e?201326592:50331648;break;case 5:o=!1,i=1,t=38==e?-134217729&t|67108864:-33554433&t|16777216;break;default:this.log("sgr unknown extended color mode:",e[1]),e=0}continue}if(o)switch(i){case 3:t=38==e?-65281&t|s[c]<<8:-256&t|s[c];break;case 2:r=38==e?16777215&r|s[c]<<24:-16711681&r|s[c]<<16;break;case 1:r=38==e?-65281&r|s[c]<<8:-256&r|s[c]}else t=38==e?-65281&t|s[c]<<8:-256&t|s[c]
;(i-=1)||(e=0)}else switch(s[c]){case 0:t=0;break;case 1:t|=65536;break;case 2:break;case 3:t|=131072;break;case 4:t|=262144;break;case 5:case 6:t|=524288;break;case 7:t|=1048576;break;case 8:t|=2097152;break;case 9:break;case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:break;case 22:t&=-65537;break;case 23:t&=-131073;break;case 24:t&=-262145;break;case 25:t&=-524289;break;case 26:break;case 27:t&=-1048577;break;case 28:t&=-2097153;break;case 29:break;case 30:case 31:case 32:case 33:case 34:case 35:case 36:case 37:t=-134283009&t|67108864|s[c]%10<<8;break;case 38:e=38;break;case 39:t&=-67108865;break;case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:t=-33554688&t|16777216|s[c]%10;break;case 48:e=48;break;case 49:t&=-16777217;break;case 90:case 91:case 92:case 93:case 94:case 95:case 96:case 97:t=-134283009&t|67108864|s[c]%10|2048;break;case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:t=-33554688&t|16777216|s[c]%10|8;break;default:this.log("sgr unknown:",s[c])}this.charattributes=t,this.reverse_video=!!(1048576&t),t&=-1048577,this.textattributes=t,this.colors=r},l.prototype.log=function(){this.debug&&console.log.apply(this,arguments)};var _={wcswidth:f,TChar:s,TRow:r,TScreen:n,AnsiTerminal:l};"undefined"!=typeof module&&void 0!==module.exports?module.exports=_:"function"==typeof define&&define.amd?define([],function(){return _}):window.ansiterminal=_}();
